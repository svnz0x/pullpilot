{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "version": "1.0.0",
  "description": "Esquema descriptivo para las variables soportadas por updater.sh",
  "variables": [
    {
      "name": "BASE_DIR",
      "type": "string",
      "default": "",
      "description": "Directorio raíz donde se escanean proyectos Docker Compose de forma recursiva cuando no se define COMPOSE_PROJECTS_FILE. Debe configurarse a una ruta absoluta existente antes de ejecutar el script.",
      "constraints": {
        "pattern": "^/.*",
        "allow_empty": false
      }
    },
    {
      "name": "LOG_DIR",
      "type": "string",
      "default": "",
      "description": "Ruta donde se almacenan los logs diarios del script. Debe establecerse a un directorio absoluto existente antes de ejecutar el script.",
      "constraints": {
        "pattern": "^/.*",
        "allow_empty": false
      }
    },
    {
      "name": "LOCK_FILE",
      "type": "string",
      "default": "/var/lock/docker-updater.lock",
      "description": "Archivo usado con flock para evitar ejecuciones simultáneas.",
      "constraints": {
        "pattern": "^/.*"
      }
    },
    {
      "name": "LOG_RETENTION_DAYS",
      "type": "integer",
      "default": 14,
      "description": "Número de días que se conservan los logs antes de depurarlos.",
      "constraints": {
        "min": 1
      }
    },
    {
      "name": "EMAIL_TO",
      "type": "string",
      "default": "",
      "description": "Dirección o lista de direcciones destino para notificaciones de correo (opcional).",
      "constraints": {
        "allow_empty": true
      }
    },
    {
      "name": "EMAIL_FROM",
      "type": "string",
      "default": "homelab@localhost",
      "description": "Dirección usada como remitente de los correos de notificación.",
      "constraints": {
        "min_length": 1
      }
    },
    {
      "name": "SUBJECT_PREFIX",
      "type": "string",
      "default": "[docker-updater]",
      "description": "Prefijo añadido al asunto de los correos enviados.",
      "constraints": {
        "min_length": 1
      }
    },
    {
      "name": "SMTP_CMD",
      "type": "string",
      "default": "msmtp",
      "description": "Comando SMTP a ejecutar para enviar correos.",
      "constraints": {
        "allowed_values": ["msmtp", "mailx", "sendmail"]
      }
    },
    {
      "name": "SMTP_ACCOUNT",
      "type": "string",
      "default": "default",
      "description": "Perfil de msmtp a emplear (se ignora en otros clientes).",
      "constraints": {
        "allow_empty": true
      }
    },
    {
      "name": "SMTP_READ_ENVELOPE",
      "type": "boolean",
      "default": true,
      "description": "Si es true, msmtp leerá las cabeceras From/To del mensaje en lugar de parámetros adicionales.",
      "constraints": {}
    },
    {
      "name": "DOCKER_TIMEOUT",
      "type": "integer",
      "default": 120,
      "description": "Tiempo máximo (en segundos) esperado para que docker compose termine las operaciones críticas.",
      "constraints": {
        "min": 1
      }
    },
    {
      "name": "QUIET_PULL",
      "type": "boolean",
      "default": true,
      "description": "Activa el flag --quiet-pull cuando la versión de docker compose lo soporta.",
      "constraints": {}
    },
    {
      "name": "PULL_POLICY",
      "type": "string",
      "default": "always",
      "description": "Política de actualización de imágenes: siempre forzar pull, confiar en --pull missing o nunca forzar.",
      "constraints": {
        "allowed_values": ["always", "missing", "never"]
      }
    },
    {
      "name": "PARALLEL_PULL",
      "type": "integer",
      "default": 0,
      "description": "Límite de pulls simultáneos (0 deja que docker decida).",
      "constraints": {
        "min": 0
      }
    },
    {
      "name": "EXCLUDE_PATTERNS",
      "type": "string",
      "default": ".git node_modules backup tmp",
      "description": "Lista separada por espacios de patrones de directorio que se deben excluir del escaneo. Se valida como lista sin entradas vacías ni saltos de línea.",
      "constraints": {
        "is_list": true,
        "list_separator": "whitespace"
      }
    },
    {
      "name": "COMPOSE_PROJECTS_FILE",
      "type": "string",
      "default": "",
      "description": "Ruta opcional a un archivo con rutas absolutas de proyectos docker-compose, una por línea.",
      "constraints": {
        "allow_empty": true,
        "pattern": "^$|^/.*",
        "disallow_path_traversal": true
      }
    },
    {
      "name": "ATTACH_LOGS_ON",
      "type": "string",
      "default": "changes",
      "description": "Controla cuándo adjuntar logs a los correos: solo con cambios, siempre o nunca.",
      "constraints": {
        "allowed_values": ["changes", "always", "never"]
      }
    },
    {
      "name": "PRUNE_ENABLED",
      "type": "boolean",
      "default": false,
      "description": "Si es true, ejecuta docker system prune tras las actualizaciones.",
      "constraints": {}
    },
    {
      "name": "PRUNE_VOLUMES",
      "type": "boolean",
      "default": false,
      "description": "Si es true, permite que docker system prune elimine volúmenes anónimos (riesgoso).",
      "constraints": {}
    },
    {
      "name": "PRUNE_FILTER_UNTIL",
      "type": "string",
      "default": "",
      "description": "Filtro de antigüedad para docker system prune (por ejemplo 168h).",
      "constraints": {
        "allow_empty": true,
        "pattern": "^$|^\\d+[smhdw]?$"
      }
    },
    {
      "name": "DRY_RUN",
      "type": "boolean",
      "default": false,
      "description": "Activa el modo simulación que muestra los comandos sin ejecutarlos.",
      "constraints": {}
    },
    {
      "name": "MIN_COMPOSE_WAIT_VERSION",
      "type": "string",
      "default": "2.17.0",
      "description": "Versión mínima de docker compose que soporta el flag --wait usado por el script.",
      "constraints": {
        "pattern": "^\\d+(\\.\\d+)*$"
      }
    },
    {
      "name": "COMPOSE_BIN",
      "type": "string",
      "default": "",
      "description": "Comando alternativo a usar como docker compose. Cuando está vacío se autodetecta.",
      "constraints": {
        "allow_empty": true
      }
    }
  ]
}
